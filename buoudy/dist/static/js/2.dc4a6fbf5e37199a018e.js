webpackJsonp([2],{"1oUW":function(e,t,i){"use strict";var s={name:"time-line-menu",props:{timeInfo:{type:Array,required:!0,validator:function(e){return e.length>0}},initialIndex:{type:Number,default:function(){return 0},validator:function(e){return e>=0}}},data:function(){return{timeLine:null,ulWidth:0,sliderWidth:0,paddingRight:0,paddingLeft:0,selectedIndex:this.initialIndex}},watch:{timeInfo:function(e){this.selectedIndex=0}},methods:{init:function(){this.timeLine=this.$refs.timeline,this.ulWidth=this.timeLine.offsetWidth,this.sliderWidth=this.timeLine.children[0].offsetWidth;var e=window.getComputedStyle(this.timeLine);this.paddingRight=+e.paddingRight.replace("px",""),this.paddingLeft=+e.paddingLeft.replace("px",""),this.scroll(this.selectedIndex),this.addClickListener()},addClickListener:function(){var e=this;this.timeLine.addEventListener("click",function(t){var i=t.target;if("LI"===i.tagName){var s=e.selectedIndex;e.selectedIndex=+i.dataset.index;var n=i.dataset.date;e.scroll(e.selectedIndex),e.$emit("timeLineClick",{proSelectedIndex:s,selectedIndex:e.selectedIndex,selectedDate:n})}})},scroll:function(e){var t=this,i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,s=window.cancelAnimationFrame||window.mozCancelAnimationFrame,n=this.timeLine.children.length*t.sliderWidth-(t.ulWidth-t.paddingLeft-t.paddingRight),d=(+e+1)*t.sliderWidth-(this.ulWidth-t.paddingLeft-t.paddingRight)/2-t.sliderWidth/2;d<0&&(d=0),d>n&&(d=n);var o=i(function e(){var n=t.timeLine.scrollLeft;n=t.timeLine.scrollLeft>d?t.timeLine.scrollLeft-20<d?d:t.timeLine.scrollLeft-20:t.timeLine.scrollLeft+20>d?d:t.timeLine.scrollLeft+20,t.timeLine.scrollTo(n,0),s(o),Math.abs(t.timeLine.scrollLeft-d)>=5&&(o=i(e))})}},mounted:function(){this.init()}},n={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("ul",{ref:"timeline",staticClass:"time-line"},e._l(e.timeInfo,function(t,s){return i("li",{class:s===e.selectedIndex?"time active":"time",attrs:{"data-index":s,"data-date":t.showDate}},[e._v(e._s(t.dateShow)+"\n    ")])}),0)])},staticRenderFns:[]};var d=i("VU/8")(s,n,!1,function(e){i("xXhv")},"data-v-0ad7940c",null);t.a=d.exports},"3HYs":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("Dd8w"),n=i.n(s),d=i("NYxO"),o=function(e){this.init(e)};o.prototype.util={isMobile:function(){var e=navigator.userAgent.toLowerCase(),t="ipad"==e.match(/ipad/i),i="iphone os"==e.match(/iphone os/i),s="midp"==e.match(/midp/i),n="rv:1.2.3.4"==e.match(/rv:1.2.3.4/i),d="ucweb"==e.match(/ucweb/i),o="android"==e.match(/android/i),a="windows ce"==e.match(/windows ce/i),l="windows mobile"==e.match(/windows mobile/i);e.match(/webview/i);return t||i||s||n||d||o||a||l},preventDefault:function(e){(e=e||window.event).preventDefault?e.preventDefault():e.returnValue=!1}},o.prototype.config={maxLeft:0,minLeft:0,isDown:!1,startLeft:0,startX:0,disX:0,duration:5,callback:void 0},o.prototype.init=function(e){var t=this.config;if(!e.el)throw new Error("请传入有效的el");e.duration&&(t.duration=e.duration),e.callback&&(t.callback=e.callback),this.sliderNode=document.querySelector(e.el);var i=this.sliderNode.children[0];this.childNodeWidth=i.clientWidth,this.sliderNode.style.width=this.childNodeWidth*this.sliderNode.children.length+"px",this.sliderNode.style.left="0px",this.sliderNode.style.paddingLeft=this.sliderNode.style.paddingRight=this.sliderNode.parentNode.clientWidth/2-this.childNodeWidth/2+"px",t.maxLeft=this.sliderNode.clientWidth-this.sliderNode.parentNode.clientWidth,t.minLeft=0,this.selectedNode=this.sliderNode.querySelector(".selected"),this.selectedIndex=this.selectedNode.dataset.index,this.scrollToSelectedNode(e.selectedIndex||0,t.callback),this.bindTouchEvent()},o.prototype.touchstart=function(e){var t=this.config;e=e||window.event;t.isDown=!0;var i=this.util.isMobile()?e.touches[0]:e;t.startX=i.clientX,this.selectedNode=this.sliderNode.querySelector(".selected"),this.selectedIndex=this.selectedNode.dataset.index,t.startLeft=this.sliderNode.offsetLeft,this.util.preventDefault(e)},o.prototype.touchmove=function(e){var t=this.config;if(t.isDown){e=e||window.event;var i=(this.util.isMobile()?e.touches[0]:e).clientX;t.disX=i-t.startX,this.sliderNode.style.left=t.startLeft+t.disX+"px"}},o.prototype.touchend=function(e){var t=this.config;e=e||window.event;if(Math.abs(t.disX)<=20)return this.reset(),void this.click(e,t.callback);this.reset(),this.selectedIndex=Math.round(Math.abs(this.sliderNode.offsetLeft)/this.childNodeWidth),this.sliderNode.offsetLeft<=-t.maxLeft&&(this.selectedIndex=this.sliderNode.children.length-1),this.sliderNode.offsetLeft>=t.minLeft&&(this.selectedIndex=0),this.scrollToSelectedNode(this.selectedIndex,t.callback)},o.prototype.scrollToSelectedNode=function(e,t){var i=this,s=i.sliderNode,n=i.childNodeWidth,d=s.offsetLeft,o=-e*n,a=Math.abs(Math.abs(o)-Math.abs(d))/i.config.duration;var l=requestAnimationFrame(function t(){if(o>d){var c=s.offsetLeft+a>o?o:s.offsetLeft+a;s.style.left=c+"px",cancelAnimationFrame(l),s.offsetLeft<-e*n?requestAnimationFrame(t):i.changeSelectedNode(e)}else o<d&&(c=s.offsetLeft-a<o?o:s.offsetLeft-a,s.style.left=c+"px",cancelAnimationFrame(l),s.offsetLeft>-e*n?l=requestAnimationFrame(t):i.changeSelectedNode(e))});"function"==typeof t&&t(e)},o.prototype.changeSelectedNode=function(e){this.config;this.selectedNode.classList.remove("selected"),this.selectedNode=this.sliderNode.children[e].children[0],this.selectedNode.classList.add("selected")},o.prototype.reset=function(){var e=this.config;e.startX=0,e.disX=0,e.isDown=!1,e.startLeft=0},o.prototype.click=function(e,t){var i="A"===e.target.tagName?e.target:e.target.parentNode;i.dataset.index&&(this.selectedIndex=i.dataset.index,this.scrollToSelectedNode(this.selectedIndex,t))},o.prototype.bindTouchEvent=function(){var e,t,i;e=this.util.isMobile()?"touchstart":"mousedown",t=this.util.isMobile()?"touchmove":"mousemove",i=this.util.isMobile()?"touchend":"mouseup",this.sliderNode.addEventListener(e,this.touchstart.bind(this)),this.sliderNode.addEventListener(t,this.touchmove.bind(this)),this.sliderNode.addEventListener(i,this.touchend.bind(this))};var a=o,l=i("AJBx"),c=i("1oUW"),r=i("543z"),h={name:"show-time-item",props:{cinemaId:{type:String,required:!0},movieId:{type:String,required:!0},sltInfo:{type:Object,required:!0}},data:function(){return{}},methods:{booking:function(){this.sltInfo.id&&(r.b.setTitleInfo("seats",document.title),this.$router.push({name:"seats",params:{id:this.cinemaId}}))}}},f={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("tr",{on:{click:e.booking}},[i("td",{staticClass:"stl-time"},[i("div",{staticClass:"stl-time-wrap"},[i("strong",[e._v(e._s(e.sltInfo.tm))]),e._v(" "),i("em",[e._v("23:52结束")])])]),e._v(" "),i("td",{staticClass:"stl-info"},[i("div",{staticClass:"stl-ver"},[e._v(e._s(e.sltInfo.lang+" "+e.sltInfo.tp))]),e._v(" "),i("div",{staticClass:"two-line"},[e._v(e._s(e.sltInfo.th))])]),e._v(" "),i("td",{staticClass:"stl-price"},[i("span",{staticClass:"unit theme-color"},[i("span",{staticClass:"stonefont"},[e._v(e._s(e.sltInfo.price))]),e._v("元")]),e._v(" "),i("span",{staticClass:"origin-price"},[e._v(e._s(e.sltInfo.extraDesc))])]),e._v(" "),e._m(0)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("td",{staticClass:"stl-buy"},[t("a",{staticClass:"stl-btn"},[this._v("选座购票")])])}]};var m=i("VU/8")(h,f,!1,function(e){i("PY1T")},"data-v-1193554c",null).exports,u={name:"show-time-list",components:{ShowTimeItem:m},props:{cinemaId:{type:String,required:!0},movieId:{type:String,required:!0},plist:{type:Array,required:!0}},data:function(){return{}}},v={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("table",e._l(e.plist,function(t,s){return i("ShowTimeItem",{key:s,attrs:{sltInfo:t,cinemaId:e.cinemaId,movieId:e.movieId}})}),1)},staticRenderFns:[]};var p=i("VU/8")(u,v,!1,function(e){i("DmV6")},"data-v-00853d76",null).exports,I=i("TVmP"),w={name:"show",props:{},components:{Loading:l.a,TimeLine:c.a,ShowTimeList:p,ShowTimeItem:m,Footer:I.a},data:function(){return{pageStatus:"loading",error:"",cinemaId:"",movieId:"",date:"",cinemaInfo:{},moviesInfo:[],movieWall:null,selectedMovie:{},selectedMovieIndex:0,plist:[],selectedDateIndex:0}},computed:n()({timeLine:function(){return this.selectedMovie.shows}},Object(d.c)(["showsInfo"])),methods:n()({},Object(d.b)({getShowsInfo:"GET_SHOWS_INFO"}),{fetchData:function(e,t,i){var s=this;this.getShowsInfo({cinemaId:e,movieId:t,date:i}).then(function(){s.cinemaInfo=s.showsInfo.cinemaInfo,s.moviesInfo=s.showsInfo.moviesInfo,s.selectedMovieIndex=s.findSelectedIndex(s.moviesInfo,"id",t),s.selectedMovie=s.moviesInfo[s.selectedMovieIndex],s.selectedDateIndex=s.findSelectedIndex(s.selectedMovie.shows,"showDate",i),s.plist=s.selectedMovie.shows[s.selectedDateIndex].plist,s.pageStatus="completed",s.$nextTick(function(){this.buildMovieWall()})}).catch(function(e){return console.log(e)})},findSelectedIndex:function(e,t,i){if(e.length<=0||!i)return 0;for(var s=0;s<e.length;s++)if(e[s][t]==i)return s;return 0},buildMovieWall:function(){var e=this;e.movieWall=new a({el:"#slider",selectedIndex:e.selectedMovieIndex,callback:function(t){t!==e.selectedMovieIndex&&(e.selectedMovieIndex=t,e.selectedMovie=e.moviesInfo[t],e.plist=e.selectedMovie.shows[0].plist)}})},timeLineClick:function(e){var t=e.proSelectedIndex,i=e.selectedIndex;t!=i&&(this.plist=this.selectedMovie.shows[i].plist)}}),watch:{$route:function(e,t){if("shows"===e.name&&"seats"!==t.name){var i=e.params.cinemaId,s=e.query.movieId,n=e.query.date;this.pageStatus="loading",this.cinemaId=i,this.fetchData(this.cinemaId,s,n)}}},created:function(){this.cinemaId=this.$route.params.cinemaId;var e=this.$route.query.movieId,t=this.$route.query.date;this.fetchData(this.cinemaId,e,t)}},L={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",["completed"===e.pageStatus?i("div",[i("div",{staticClass:"showtime-cinema-info"},[i("div",{staticClass:"stci-info"},[i("div",{staticClass:"cinema-name"},[e._v(e._s(e.cinemaInfo.name))]),e._v(" "),i("p",{staticClass:"cinema-address"},[e._v(e._s(e.cinemaInfo.address))])]),e._v(" "),i("div",{staticClass:"cinema-tel"},[i("a",{attrs:{href:"tel:"+e.cinemaInfo.tel,"data-tel":"cinemaDetail.tel"}},[i("i",{staticClass:"phone-icon"})])])]),e._v(" "),i("div",{staticClass:"showtime-movies"},[i("ul",{ref:"slider",attrs:{id:"slider"}},e._l(e.moviesInfo,function(e,t){return i("li",[i("a",{class:{selected:!t},attrs:{"data-index":t,"data-id":e.id}},[i("img",{attrs:{src:e.poster}})])])}),0)]),e._v(" "),i("div",{staticClass:"showtime-mname"},[i("a",{staticClass:"movie-relative"},[i("span",{staticClass:"movie-name"},[e._v(e._s(e.selectedMovie.name))]),e._v(" "),i("span",{staticClass:"sc"},[i("strong",[e._v(e._s(e.selectedMovie.score))]),e._v("分")])])]),e._v(" "),i("TimeLine",{attrs:{timeInfo:e.timeLine,initialIndex:e.selectedDateIndex},on:{timeLineClick:e.timeLineClick}}),e._v(" "),i("div",{staticClass:"showtime-list"},[e.plist.length>0?i("ShowTimeList",{attrs:{plist:e.plist,cinemaId:e.cinemaId,movieId:e.selectedMovie.id}}):i("div",{staticClass:"sell-out"},[e._v("今日场次已映完")])],1),e._v(" "),i("Footer",{attrs:{type:"flink"}})],1):e._e(),e._v(" "),"loading"===e.pageStatus?i("Loading"):e._e()],1)},staticRenderFns:[]};var g=i("VU/8")(w,L,!1,function(e){i("lMXX")},"data-v-7192717d",null);t.default=g.exports},DmV6:function(e,t){},PY1T:function(e,t){},lMXX:function(e,t){},xXhv:function(e,t){}});
//# sourceMappingURL=2.dc4a6fbf5e37199a018e.js.map